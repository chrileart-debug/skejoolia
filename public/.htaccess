# Hostinger/Apache rules for React SPA + PWA
# This file is copied to dist/.htaccess on build (Vite public/ -> dist/)

# ============================================
# 1. SPA REWRITE RULES (React Router support)
# ============================================
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # If the request is for a real file or directory, serve it directly
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d

  # Otherwise, rewrite to index.html (SPA fallback)
  RewriteRule ^.*$ /index.html [L]
</IfModule>

# ============================================
# 2. CACHE CONTROL HEADERS
# ============================================
<IfModule mod_headers.c>
  # NEVER cache index.html - must always fetch fresh from server
  <FilesMatch "^index\.html$">
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
  </FilesMatch>

  # NEVER cache PWA control files (avoid stuck Service Worker)
  <FilesMatch "^(sw\.js|manifest\.webmanifest|registerSW\.js)$">
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
  </FilesMatch>

  # Cache static assets aggressively (Vite assets are content-hashed)
  <FilesMatch "\.(?:js|css|png|jpg|jpeg|gif|svg|webp|woff|woff2)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
</IfModule>
